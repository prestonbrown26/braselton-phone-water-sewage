{% extends "admin_base.html" %}
{% block title %}Call Logs - Braselton Utilities{% endblock %}
{% block extra_css %}
<style>
  .calls-page h1 {
    color: #1f2a48;
    margin-bottom: 6px;
  }
  .calls-page .subtitle {
    color: #6b7280;
    margin-bottom: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background-color: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(15, 23, 42, 0.05);
  }
  th,
  td {
    padding: 0.85rem;
    border-bottom: 1px solid var(--border);
    text-align: left;
    font-size: 14px;
  }
  th {
    background: var(--brand);
    color: #fff;
    font-weight: 600;
    letter-spacing: 0.5px;
  }
  tbody tr:nth-child(even) {
    background-color: #f7f8ff;
  }
  .badge {
    padding: 0.25rem 0.55rem;
    border-radius: 999px;
    font-size: 0.78rem;
    font-weight: 600;
    color: #fff;
  }
  .badge-positive {
    background-color: #16a34a;
  }
  .badge-neutral {
    background-color: #94a3b8;
  }
  .badge-negative {
    background-color: #dc2626;
  }
</style>
{% endblock %}
{% block content %}
<div class="card calls-page">
  <h1>Call Logs</h1>
  <p class="subtitle">Recent interactions handled by the AI agent</p>
  <table>
    <thead>
      <tr>
        <th>Call ID</th>
        <th>Caller</th>
        <th>Transcript</th>
        <th>Sentiment</th>
        <th>Email Sent</th>
        <th>Created At</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr>
        <td>
          <a href="{% url 'admin-call-detail' log.id %}" style="color: var(--brand); font-weight:600; text-decoration:none;">
            {{ log.call_id }}
          </a>
        </td>
        <td>{{ log.caller_number|default:"Unknown" }}</td>
        <td style="max-width: 380px; white-space: pre-line">
          {{ log.transcript|slice:":350" }}{% if log.transcript|length > 350 %}…{% endif %}
        </td>
        <td>
          {% if log.sentiment %}
            {% if log.sentiment == 'positive' %}
              <span class="badge badge-positive">Positive</span>
            {% elif log.sentiment == 'negative' %}
              <span class="badge badge-negative">Negative</span>
            {% else %}
              <span class="badge badge-neutral">Neutral</span>
            {% endif %}
          {% else %}
            <span class="badge badge-neutral">n/a</span>
          {% endif %}
        </td>
        <td>{% if log.email_sent %}Yes{% else %}No{% endif %}</td>
        <td>{{ log.display_time }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6">No call logs recorded yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if page_obj %}
  <div style="margin-top:16px; display:flex; gap:12px; align-items:center;">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" style="text-decoration:none;">← Previous</a>
    {% endif %}
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" style="text-decoration:none;">Next →</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}

